(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Siteswap = f()}})(function(){var define,module,exports;module={exports:(exports={})};
"use strict";function t(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Toss(t,e,r){this.value=t,this.handFrom=e,this.handTo=r}function o(t){return t.reduce(function(t,e){return t.includes(e)||t.push(e),t},[])}function i(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++){var n=t[r],o=e[r];if(n.length!==o.length)return!1;for(var i=0;i<n.length;i++){var s=n[i],a=o[i];if(s.length!==a.length)return!1;for(var u=0;u<s.length;u++){var h=s[u],l=a[u];if(h.value!==l.value||h.handFrom!==l.handFrom||h.handTo!==l.handTo)return!1}}}return!0}function s(t,e,r,n,o){var i=r[n][o],a=!0,u=!1,h=void 0;try{for(var l,c=i[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var f=l.value;if(0!==f.value){var p=(n+f.value)%r.length;e[p][f.handTo]!==t&&(e[p][f.handTo]=t,s(t,e,r,p,f.handTo))}}}catch(t){u=!0,h=t}finally{try{!a&&c.return&&c.return()}finally{if(u)throw h}}}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(){function t(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function t(e,r,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,r);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,r,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),c=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n(this,t),this.type=e,this.value=r},f=function(){function t(){n(this,t)}return l(t,[{key:"tokenise",value:function(t,e){for(var r=[],n=Object.keys(e),o=t;o.length;)if(!n.some(function(t){var n=o.match(e[t]);if(n){var i=n[0];return r.push(new c(t,i)),o=o.slice(i.length),!0}return!1}))throw new Error("Unsupported character.");return r.push(new c("end")),r}}]),t}(),p=function(t){function o(){n(this,o);var t=e(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.tokenTypes={"[":/^\[/,"]":/^\]/,"(":/^\(/,")":/^\)/,",":/^,/," ":/^ /,value:/^(?:(?:[1-9][0-9]+)|[0-9])/,hand:/^[a-zA-Z]+/},t}return r(o,f),l(o,[{key:"tokenise",value:function(t){return h(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"tokenise",this).call(this,t,this.tokenTypes)}}]),o}(),v=function(t){function o(){n(this,o);var t=e(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.tokenTypes={legacy:{"[":/^\[/,"]":/^\]/,"(":/^\(/,")":/^\)/,",":/^,/," ":/^ /,cross:/^x/,value:/^(?:(?:[1-9][0-9]+)|[0-9]|[a-zA-Z])/,mirror:/^\*/},legacyCompressed:{"[":/^\[/,"]":/^\]/,"(":/^\(/,")":/^\)/,",":/^,/," ":/^ /,cross:/^x/,value:/^(?:[0-9]|[a-zA-Z])/,mirror:/^\*/}},t}return r(o,f),l(o,[{key:"numerify",value:function(t){var e=/^[a-z]$/i,r=/^[1-9][0-9]+$/,n=t.some(function(t){return e.test(t.value)}),o=t.some(function(t){return r.test(t.value)});if(n&&o)throw new Error("Inconsistent use of letters and double digit throw values.");if(n){var i={a:10-"a".charCodeAt(0),A:36-"A".charCodeAt(0)},s=!0,a=!1,u=void 0;try{for(var h,l=t[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var c=h.value;/[a-z]/.test(c.value)?c.value=c.value.charCodeAt(0)+i.a:/[A-Z]/.test(c.value)&&(c.value=c.value.charCodeAt(0)+i.A)}}catch(t){a=!0,u=t}finally{try{!s&&l.return&&l.return()}finally{if(a)throw u}}}}},{key:"separate",value:function(t){for(var e=[],r=0;r<t.length-1;r++)e.push(t[r]),"value"!==t[r].type&&"hand"!==t[r].type||"value"!==t[r+1].type||e.push(new c(",",","));return e.push(t[t.length-1]),e}},{key:"halve",value:function(t){var e=!0,r=!1,n=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=o.value,a=parseInt(s.value);if(a%2==1)throw new Error("Legacy sync mode allows only odd throw values.");s.value=a/2}}catch(t){r=!0,n=t}finally{try{!e&&i.return&&i.return()}finally{if(r)throw n}}}},{key:"handify",value:function(t,e){for(var r=[],n=0;n<t.length;n++)if("("===t[n].type&&n+1<t.length&&"value"===t[n+1].type){r.push(t[n++]),r.push(t[n++]);var o=void 0;"cross"===t[n].type?o=e[1]:(o=e[0],n--),r.push(new c("hand",o))}else if("value"===t[n].type&&(n+1<t.length&&")"===t[n+1].type||n+2<t.length&&")"===t[n+2].type)){r.push(t[n++]);var i=void 0;"cross"===t[n].type?i=e[0]:(i=e[1],n--),r.push(new c("hand",i)),r.push(t[++n])}else r.push(t[n]);return r}},{key:"tokenise",value:function(t,e){var r=t.includes("("),n=(r?/\([^)]*[, ].*\)/:/[, ]/).test(t),i=this.tokenTypes[n?"legacy":"legacyCompressed"],s=h(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"tokenise",this).call(this,t,i),a=s.filter(function(t){return"value"===t.type});return this.numerify(a),n&&(s=this.separate(s)),r&&this.halve(a),s=this.handify(s,e)}}]),o}(),y=function(){function t(){n(this,t),this.state=null,this.tokens=null,this.legacyTokeniser=new v,this.genericTokeniser=new p}return l(t,[{key:"upcoming",value:function(t){var e=this;return"string"==typeof t?this.tokens[this.tokens.length-1].type===t:t.some(function(t){return e.tokens[e.tokens.length-1].type===t})}},{key:"expect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unexpected token.";if(!this.upcoming(t))throw new Error(e);return this.tokens.pop().value}},{key:"set",value:function(t,e,r){if(void 0===this.state[t])this.state[t]=e;else if(this.state[t]!==e)throw new Error(r)}},{key:"autoset",value:function(t,e,r){var n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var u=s.value;if(this.upcoming(u))return this.set(t,u,r),u}}catch(t){o=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}return this.set(t,null,'Expecting "'+this.state[t]+'", got "'+this.tokens[this.tokens.length-1].type+'".'),null}},{key:"parse",value:function(t,e,r){this.state={};var n=t.trim().replace(/  +/g," ").replace(/ ?([[,]|[\],]) ?/g,"$1");if(""===n)throw new Error("No siteswap supplied.");var o=r?this.legacyTokeniser:this.genericTokeniser;return this.tokens=o.tokenise(n,e).reverse(),this.siteswap(e)}},{key:"siteswap",value:function(t){for(var e=[this.action(t)],r=[","," "],n=this.upcoming(r);!this.upcoming("end");){if(n){var o=this.autoset("actionSeparator",r,"Inconsistent use of action separators");this.expect(o)}e.push(this.action(t))}return e}},{key:"action",value:function(t){if(1===t.length)return this.autoset("actionBrackets","(","Inconsistent use of action brackets"),[this.release(t,t[0])];this.expect("(");for(var e=[this.release(t,t[0])],r=[","," "],n=this.upcoming(r),o=1;o<t.length;o++){if(n){var i=this.autoset("releaseSeparator",r,"Inconsistent use of release separators");this.expect(i)}e.push(this.release(t,t[o]))}return this.expect(")"),e}},{key:"release",value:function(t,e){if(!this.upcoming("["))return this.set("releaseBrackets",!1,"Inconsistent use of release brackets."),[this.toss(t,e)];this.expect("[");for(var r=[this.toss(t,e)],n=[","," "],o=this.upcoming(n);!this.upcoming("]");){if(o){var i=this.autoset("tossSeparator",n,"Inconsistent use of toss separators");this.expect(i)}r.push(this.toss(t,e))}return this.expect("]"),1===r.length&&this.set("releaseBrackets",!0,"Inconsistent use of release brackets."),r}},{key:"toss",value:function(t,e){var r=parseInt(this.expect("value")),n=void 0;return this.upcoming("hand")?(n=this.expect("hand"))===e&&this.set("selfHand",!1,"Same hand throws inconsistently denoted."):(this.set("selfHand",!0,"Same hand throws inconsistently denoted."),n=e),0===r?new Toss(0,null,null):new Toss(r,t.indexOf(e),t.indexOf(n))}}]),t}(),d=void 0,g=/^[a-z]$/i,Juggle=function Juggle(e,r){n(this,Juggle),this.input=e;try{var o=void 0,i=void 0,s=!1;if("string"==typeof e){var h=e.split(":").reverse(),l=u(h,2);o=l[0],(i=l[1])&&(i=i.replace(" ","").split(","))}else{if("object"!==(void 0===e?"undefined":a(e))||!e.siteswap)throw new Error("Invalid input.");var c=[e.siteswap,e.hands];o=c[0],i=c[1]}if(r){if(i||(i="string"==typeof o?o.includes("(")?["l","r"]:["l"]:2===o[0].length?["l","r"]:["l"]),i.length>2)throw new Error("Legacy mode supports at most two hands.");var f=/\* *$/;"string"==typeof o&&f.test(o)&&(o=o.replace(f,""),s=!0)}this.validateHands(i);var p="string"==typeof o?this.parse(o,i,r):o;this.validateThrows(p),s&&this.mirrorThrows(p);var v=p.reduce(function(t,e){return Array.prototype.concat.apply(t,e.map(function(t){return t.map(function(t){return t.value})}))},[]);this.hands=i,this.throws=p,this.valid=!0,this.degree=i.length,this.props=v.reduce(function(t,e){return t+e},0)/this.throws.length,this.multiplex=p.reduce(function(e,r){return Math.max.apply(null,[e].concat(t(r.map(function(t){return t.length}))))},0),this.greatestValue=Math.max.apply(null,v),this.string=this.stringify(this.throws,this.hands)}catch(t){this.valid=!1,this.message=t.message}};Juggle.prototype.parse=function(t,e,r){return d||(d=new y),d.parse(t,e,r)},Juggle.prototype.validateHands=function(t){if(!Array.isArray(t)||!t.length||!t.every(function(t){return"string"==typeof t&&g.test(t)})||o(t).length!==t.length)throw new Error("Invalid hand sequence.")},Juggle.prototype.validateThrows=function(t){if(!Array.isArray(t)||!t.length)throw new Error("Invalid throw sequence.");var e=!0,r=!1,n=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=o.value;if(!Array.isArray(s)||s.length!==t[0].length)throw new Error("Invalid throw sequence.");if(s.some(function(t){return!Array.isArray(t)||!t.every(function(t){return t instanceof Toss})}))throw new Error("Invalid throw sequence.")}}catch(t){r=!0,n=t}finally{try{!e&&i.return&&i.return()}finally{if(r)throw n}}},Juggle.prototype.mirrorThrows=function(t){for(var e=0,r=t.length;e<r;e++)t.push(t[e].map(function(t){return t.map(function(t){return new Toss(t.value,1-t.handFrom,1-t.handTo)})}).reverse())},Juggle.prototype.stringify=function(t,e){return 1===e.length?t.map(function(t){var e=t[0],r=e.map(function(t){return t.value}).join(",");return 1===e.length?r:"["+r+"]"}).join(","):t.map(function(t){return"("+t.map(function(t){var r=t.map(function(t){return t.value+(0===t.value?"":e[t.handTo])}).join(",");return 1===t.length?r:"["+r+"]"}).join(",")+")"}).join("")};var State=function State(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n(this,State);var r=void 0;if(t instanceof Array)r=t;else{if(!(t instanceof Siteswap))throw new Error("Invalid input.");r=[];for(var o=t,i=0;i<o.degree;i++){for(var s=[],a=0;a<o.greatestValue;a++)s.push(e?[]:0);r.push(s)}for(var u=0,h=-1;u<o.props;h--){var l=o.throws[(h%o.throws.length+o.throws.length)%o.throws.length],c=!0,f=!1,p=void 0;try{for(var v,y=l[Symbol.iterator]();!(c=(v=y.next()).done);c=!0){var d=v.value,g=!0,w=!1,m=void 0;try{for(var b,k=d[Symbol.iterator]();!(g=(b=k.next()).done);g=!0){var x=b.value;h+x.value>=0&&(e?r[x.handTo][h+x.value].push(u):r[x.handTo][h+x.value]++,u++)}}catch(t){w=!0,m=t}finally{try{!g&&k.return&&k.return()}finally{if(w)throw m}}}}catch(t){f=!0,p=t}finally{try{!c&&y.return&&y.return()}finally{if(f)throw p}}}}this.schedule=r,this.strict=e,this.ground=!this.isExcited()};State.prototype.advance=function(e){var r=[];this.strict?r.push.apply(r,t(this.schedule.map(function(e){return[].concat(t(e.slice(1).map(function(t){return t.slice()})),[[]])}))):r.push.apply(r,t(this.schedule.map(function(e){return[].concat(t(e.slice(1)),[0])})));var n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)for(var u=s.value,h=0;h<u.length;h++){var l=u[h];if(l.value>0)if(this.strict){var c=this.schedule[l.handFrom][0][h];r[l.handTo][l.value-1].push(c)}else r[l.handTo][l.value-1]++}}catch(t){o=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}return new State(r,this.strict)},State.prototype.equals=function(t){if(this.strict!==t.strict)return!1;var e=this.schedule,r=t.schedule;if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++){if(e[n].length!==r[n].length)return!1;for(var o=0;o<e[n].length;o++)if(this.strict){if(e[n][o].length!==r[n][o].length)return!1;for(var i=0;i<e[n][o].length;i++)if(e[n][o][i]!==r[n][o][i])return!1}else if(e[n][o]!==r[n][o])return!1}return!0},State.prototype.isExcited=function(){this.schedule;var t=void 0;t=this.strict?this.schedule.reduce(function(t,e){return t+e.reduce(function(t,e){return t+e.length},0)},0):this.schedule.reduce(function(t,e){return t+e.reduce(function(t,e){return t+e},0)},0);var e=this.schedule.length,r=this.schedule[0].length,n=Math.floor(t/e),o=t%e;if(this.strict)for(var i=0;i<e;i++){for(var s=0;s<n;s++)if(1!==this.schedule[i][s].length)return!0;if(n!==r){for(var a=1===this.schedule[i][n].length?1:0,u=n+a;u<r;u++)if(0!==this.schedule[i][u].length)return!0;o-=a}}else for(var h=0;h<e;h++){for(var l=0;l<n;l++)if(1!==this.schedule[h][l])return!0;for(var c=1===this.schedule[h][n]?1:0,f=n+c;f<r;f++)if(0!==this.schedule[h][f])return!0;o-=c}return 0!==o};var Transition=function(t){function Transition(t,r,o){var i,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];n(this,Transition);var a=e(this,(Transition.__proto__||Object.getPrototypeOf(Transition)).call(this,t,s));return a.valid?(a.stateFrom=r,a.stateTo=o,a):(i=a,e(a,i))}return r(Transition,Juggle),Transition}(),Siteswap=function(t){function Siteswap(t){var r,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n(this,Siteswap);var i=e(this,(Siteswap.__proto__||Object.getPrototypeOf(Siteswap)).call(this,t,o));if(!i.valid)return r=i,e(i,r);try{i.validate(i.throws,i.hands),i.valid=!0}catch(t){var s,a=Object.keys(i).filter(function(t){return"input"!==t}),u=!0,h=!1,l=void 0;try{for(var c,f=a[Symbol.iterator]();!(u=(c=f.next()).done);u=!0){var p=c.value;delete i[p]}}catch(t){h=!0,l=t}finally{try{!u&&f.return&&f.return()}finally{if(h)throw l}}return i.valid=!1,i.message=t.message,s=i,e(i,s)}return i.truncate(i.throws),i.states=0===i.greatestValue?[]:i.schedulise(i.throws,!1),i.strictStates=0===i.greatestValue?[]:i.schedulise(i.throws,!0),i.orbits=i.orbitise(i.throws,i.hands),i.composition=i.decompose(i.states,i.throws,i.hands),i.period=i.states.length,i.fullPeriod=i.strictStates.length,i.prime=1===i.composition.length,i.groundState=i.excitify(),i}return r(Siteswap,Juggle),Siteswap}();Siteswap.prototype.validate=function(t){for(var e=t.map(function(t){return t.map(function(t){return 0})}),r=0;r<t.length;r++){var n=t[r],o=!0,i=!1,s=void 0;try{for(var a,u=n[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var h=a.value,l=!0,c=!1,f=void 0;try{for(var p,v=h[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var y=p.value;e[r][y.handFrom]++,e[(r+y.value)%t.length][y.handTo]--}}catch(t){c=!0,f=t}finally{try{!l&&v.return&&v.return()}finally{if(c)throw f}}}}catch(t){i=!0,s=t}finally{try{!o&&u.return&&u.return()}finally{if(i)throw s}}}if(e.some(function(t){return t.some(function(t){return 0!==t})}))throw new Error("Invalid siteswap.")},Siteswap.prototype.truncate=function(t){for(var e=1,r=Math.floor(t.length/2);e<=r;e++)if(t.length%e==0)for(var n=t.slice(0,e),o=e;o<t.length&&i(n,t.slice(o,o+e));o+=e)if(e+o===t.length)return t.length=e,t},Siteswap.prototype.schedulise=function(t,e){var r=[new State(this,e)];do{var n=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var u=s.value;r.push(r[r.length-1].advance(u))}}catch(t){o=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}}while(!r[0].equals(r[r.length-1]));return r.pop(),r},Siteswap.prototype.excitify=function(){return this.states.some(function(t){return t.ground})},Siteswap.prototype.orbitise=function(t,e){for(var r=[],n=t.map(function(t){return t.map(function(t){return null})}),o=0;o<t.length;o++)for(var i=t[o],a=0;a<i.length;a++){var u=i[a];if(null===n[o][a]&&(1!==u.length||0!==u[0].value)){var h=[];s(h,n,t,o,a),r.push(h)}}if(1===r.length)return[this];for(var l=0;l<t.length;l++)!function(e){var o=t[e],i=!0,s=!1,a=void 0;try{for(var u,h=r[Symbol.iterator]();!(i=(u=h.next()).done);i=!0)!function(t){t.push(o.map(function(r,o){return n[e][o]===t?r:[new Toss(0,null,null)]}))}(u.value)}catch(t){s=!0,a=t}finally{try{!i&&h.return&&h.return()}finally{if(s)throw a}}}(l);return r.map(function(t){return new Siteswap({hands:e,siteswap:t})})},Siteswap.prototype.decompose=function(t,e,r){for(var n=[],o=0,i=1;i<=t.length;i++)for(var s=i-1;s>=o;s--)if(t[i%t.length].equals(t[s])){if(0===s&&i===t.length)return[this];s>o&&n.push(new Transition({hands:r,siteswap:e.slice(o,s)},t[o],t[s])),n.push(new Siteswap({hands:r,siteswap:e.slice(s,i)})),o=i;break}return o!==t.length&&n.push(new Transition({hands:r,siteswap:e.slice(o)})),n},Siteswap.prototype.log=function(){var t=this;if(this.valid){var e=[];e.push("siteswap\n "+this.string),e.push("props\n "+this.props),e.push("period\n "+this.period),e.push("hands\n "+this.degree),e.push("multiplex\n "+this.multiplex),e.push("full period\n "+this.fullPeriod),e.push("prime\n "+this.prime),e.push("ground state\n "+this.groundState),e.push("throw sequence"),this.throws.forEach(function(r,n){return r.forEach(function(r,o){return e.push(" "+(n+1)+(1===t.degree?"":", hand "+t.hands[(n+o)%t.degree])+": ["+r.map(function(e){return e.value+(0===e.value||1===t.degree?"":t.hands[e.handTo])}).join(",")+"]")})}),e.push("states"),this.states.forEach(function(r,n){return r.schedule.forEach(function(r,o){return e.push(" "+(n+1)+(1===t.degree?"":", hand "+t.hands[o])+": ["+r.join(",")+"]")})}),e.push("strict states"),this.strictStates.forEach(function(r,n){return r.schedule.forEach(function(r,o){return e.push(" "+(n+1)+(1===t.degree?"":", hand "+t.hands[o])+": ["+r.map(function(t){return"["+(t.length?t.join(","):"-")+"]"}).join(",")+"]")})}),e.push("orbits"),this.orbits.forEach(function(t,r){return e.push(" "+(r+1)+": "+t.string)}),e.push("composition"),this.composition.forEach(function(t,r){return e.push((t instanceof Siteswap?" siteswap: ":" transition: ")+t.string)}),e.push(" "),console.log(e.join("\n"))}else console.log("Invalid siteswap.")},module.exports=Siteswap;
return module.exports;});