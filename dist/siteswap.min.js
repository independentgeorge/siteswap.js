(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Siteswap = f()}})(function(){var define,module,exports;module={exports:(exports={})};
"use strict";var ir=function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,n){var t=[],e=!0,o=!1,a=void 0;try{for(var i,u=r[Symbol.iterator]();!(e=(i=u.next()).done)&&(t.push(i.value),!n||t.length!==n);e=!0);}catch(r){o=!0,a=r}finally{try{!e&&u.return&&u.return()}finally{if(o)throw a}}return t}(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(){function e(r,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};function ur(r){if(Array.isArray(r)){for(var n=0,t=Array(r.length);n<r.length;n++)t[n]=r[n];return t}return Array.from(r)}function u(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function s(r){if(!function(r){if(!Array.isArray(r)||!r.length)return!1;var n=function(o){return Array.isArray(o)&&o.length===r[0].length?o.some(function(r){return!Array.isArray(r)||!r.every(function(r){var n=r.value,t=r.handFrom,e=r.handTo;return void 0!==n&&void 0!==t&&void 0!==e&&t<o.length&&e<o.length})})?{v:!1}:void 0:{v:!1}},t=!0,e=!1,o=void 0;try{for(var a,i=r[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var u=a.value,s=n(u);if("object"===(void 0===s?"undefined":x(s)))return s.v}}catch(r){e=!0,o=r}finally{try{!t&&i.return&&i.return()}finally{if(e)throw o}}return!0}(r))throw new Error("Invalid input.");for(var n=r.map(function(r){return r.map(function(r){return 0})}),t=0;t<r.length;t++){var e=r[t],o=!0,a=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value,f=!0,c=!1,h=void 0;try{for(var p,v=l[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var y=p.value;n[t][y.handFrom]++,n[(t+y.value)%r.length][y.handTo]--}}catch(r){c=!0,h=r}finally{try{!f&&v.return&&v.return()}finally{if(c)throw h}}}}catch(r){a=!0,i=r}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}}if(n.some(function(r){return r.some(function(r){return 0!==r})}))throw new Error("Invalid siteswap.")}function l(r,n){if(r.length!==n.length)return!1;for(var t=0;t<r.length;t++){var e=r[t],o=n[t];if(e.length!==o.length)return!1;for(var a=0;a<e.length;a++){var i=e[a],u=o[a];if(i.length!==u.length)return!1;for(var s=0;s<i.length;s++){var l=i[s],f=u[s];if(l.value!==f.value||l.handFrom!==f.handFrom||l.handTo!==f.handTo)return!1}}}return!0}var e={schedules:new Map,strings:new Map},State=function(){function State(r){if(u(this,State),!Array.isArray(r)||!r.every(Array.isArray))throw new Error("Invalid input.");var n=e.schedules.get(r);if(n)return n;var t=r.map(function(r){return r.join(",")}).join("-");if(n=e.strings.get(t))return n;e.schedules.set(r,this),e.strings.set(t,this),this.schedule=r}return r(State,[{key:"advance",value:function(r){for(var n=this.schedule.map(function(r){return r.slice(1)}),t=0;t<r.length;t++){var e=r[t];if(e.filter(function(r){return r.value}).length!==(this.schedule[t][0]||0))throw new Error("dead");if(e.length){var o=!0,a=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value,f=l.value,c=l.handTo;l.handFrom;if(!(f<=0)){n[c][f-1]=(n[c][f-1]||0)+1;for(var h=0;h<n.length;h++)for(var p=this.schedule[0].length-1;p<f;p++)n[h][p]||(n[h][p]=0)}}}catch(r){a=!0,i=r}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}}}return new State(n)}}]),State}();function f(r){var n=[],t=function(t){for(var e=[],r=0;r<t.degree;r++)e.push(Array(t.greatestValue).fill(0));if(0===t.greatestValue)return new State(e);for(var n=t.throws,o=0,a=-1;;a--){var i=n[(a%n.length+n.length)%n.length],u=!0,s=!1,l=void 0;try{for(var f,c=i[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){var h=f.value,p=!0,v=!1,y=void 0;try{for(var m,d=h[Symbol.iterator]();!(p=(m=d.next()).done);p=!0){var g=m.value,w=a+g.value;if(!(w<0)&&(e[g.handTo][w]++,++o===t.props)){var b=function(){for(var n=t.greatestValue;e.every(function(r){return 0===r[n-1]});)n--;for(var r=0;r<t.degree;r++)e[r].length=n;return{v:new State(e)}}();if("object"===(void 0===b?"undefined":x(b)))return b.v}}}catch(r){v=!0,y=r}finally{try{!p&&d.return&&d.return()}finally{if(v)throw y}}}}catch(r){s=!0,l=r}finally{try{!u&&c.return&&c.return()}finally{if(s)throw l}}}}(r),e=t;do{var o=!0,a=!1,i=void 0;try{for(var u,s=r.throws[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value;n.push(e.schedule),e=e.advance(l)}}catch(r){a=!0,i=r}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}}while(t!==e);return n}function c(r){var n,t,e=[],o=(n=r.states[0],t=0,n.map(function(r){return r.map(function(r){return Array(r).fill().map(function(){return++t})})})),a=o;do{var i=!0,u=!1,s=void 0;try{for(var l,f=r.throws[Symbol.iterator]();!(i=(l=f.next()).done);i=!0){var c=l.value;e.push(a),a=h(a,c)}}catch(r){u=!0,s=r}finally{try{!i&&f.return&&f.return()}finally{if(u)throw s}}}while(!p(o,a));return e}function h(u,s){for(var l=u.map(function(r){return r.slice(1).map(function(r){return[].concat(ur(r))})}),r=function(o){var r=s[o];if(!r.length&&r.every(function(r){var n=r.value,t=r.handTo,e=r.handFrom;return 0===n&&t===o&&e===o}))return"continue";for(var n=0;n<r.length;n++){var t=r[n];if(!(t.value<=0)){for(var e=u[t.handFrom][0][n],a=0;a<l.length;a++)for(var i=u[0].length-1;i<t.value;i++)l[a][i]||(l[a][i]=[]);l[t.handTo][t.value-1].push(e)}}},n=0;n<s.length;n++)r(n);return l}function p(r,n){if(r.length!==n.length)return!1;for(var t=0;t<r.length;t++){var e=r[t],o=n[t];if(e.length!==o.length)return!1;for(var a=0;a<e.length;a++){var i=e[a],u=o[a];if(i.length!==u.length)return!1;for(var s=0;s<i.length;s++)if(i[s]!==u[s])return!1}}return!0}function v(r,n,t,e,o){var a=t[e][o],i=!0,u=!1,s=void 0;try{for(var l,f=a[Symbol.iterator]();!(i=(l=f.next()).done);i=!0){var c=l.value;if(0!==c.value){var h=(e+c.value)%t.length;n[h][c.handTo]!==r&&v(n[h][c.handTo]=r,n,t,h,c.handTo)}}}catch(r){u=!0,s=r}finally{try{!i&&f.return&&f.return()}finally{if(u)throw s}}}function y(r){for(var s=r.throws,n=r.notation,l=[],f=s.map(function(r){return r.map(function(r){return null})}),t=0;t<s.length;t++)for(var e=s[t],o=0;o<e.length;o++){var a=e[o];if(null===f[t][o]&&(1!==a.length||0!==a[0].value)){var i=[];v(i,f,s,t,o),l.push(i)}}if(1===l.length)return[r];for(var u=function(e){var r=s[e],n=function(t){t.push(r.map(function(r,n){return f[e][n]===t?r:[{value:0,handFrom:n,handTo:n}]}))},t=!0,o=!1,a=void 0;try{for(var i,u=l[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){n(i.value)}}catch(r){o=!0,a=r}finally{try{!t&&u.return&&u.return()}finally{if(o)throw a}}},c=0;c<s.length;c++)u(c);return l.map(function(r){return new Siteswap(r,n)})}function m(r){for(var n=[],t=[].concat(ur(r.throws)),e=[].concat(ur(r.states)),o=r.notation,a=0,i=1;i<=e.length;i++)for(var u=i-1;a<=u;u--)if(e[i%e.length]===e[u]){if(0===u&&i===e.length)return n.length?(d(n,new Siteswap(t.slice(u,i),o)),n):[r];a===u?(d(n,new Siteswap(t.slice(u,i),o)),a=i):(d(n,new Siteswap(t.splice(u,i-u),o)),e.splice(u,i-u),i=a);break}return n}function d(r,n){r.every(function(r){return!r.equals(n)})&&r.push(n)}var a="A".charCodeAt(0),i="Z".charCodeAt(0)-a+1;function sr(r){return"A".repeat(Math.floor(r/i))+String.fromCharCode(a+r%i)}for(var g=!0,w={ws:function(){return{allow:" "}},trim:function(r){var n=w.ws();return{symbols:[n,r,n],processor:function(r){return ir(r,2)[1]}}},separator:function(){if(g){var r=w.ws();return{either:[{symbols:[r,",",r]}," "],fixed:!0}}return{either:[","," "],fixed:!0}},separated:function(r,n,t){return{symbols:[t,{repeat:[r,t],min:n-1,max:1/0}],processor:function(r){var n,t=ir(r,2),e=t[0],o=(n=t[1],Array.isArray(n)?n:Array.from(n)).slice(0);return[e].concat(ur(o.map(S)))}}},release:function(r,n){var t=w.separated(n,2,r);return{either:[{symbols:[r]},{symbols:["[",g?w.trim(t):t,"]"],processor:function(r){return ir(r,2)[1]}}]}},asyncSiteswap:function(r,n){w.ws();return{symbol:w.separated(n,1,w.release(r,n)),processor:function(r){return r.map(function(r){return[r]})}}},syncSiteswap:function(r,n,t){var e=w.ws(),o=w.release(r,n);if(g){var a={symbols:["(",e,o,t,o,e,")"],processor:function(r){var n=ir(r,5);return[n[2],n[4]]}};return{symbols:[w.separated(e,1,a),e,{allow:"*"}],processor:function(r){var n=ir(r,3),t=n[0];return n[2]?k(t):t}}}var i={symbols:["(",o,t,o,")"],processor:function(r){var n=ir(r,4);return[n[1],n[3]]}};return{symbols:[w.separated(null,1,i),{allow:"*"}],processor:function(r){var n=ir(r,2),t=n[0];return n[1]?k(t):t}}}},n=[{tokenType:"[",regex:"\\["},{tokenType:"]",regex:"\\]"},{tokenType:"(",regex:"\\("},{tokenType:")",regex:"\\)"},{tokenType:"<",regex:"<"},{tokenType:">",regex:">"},{tokenType:"\n",regex:"\n"},{tokenType:"|",regex:"\\|"},{tokenType:"-",regex:"-"},{tokenType:",",regex:","},{tokenType:" ",regex:" +"},{tokenType:"*",regex:"\\*"},{tokenType:"x",regex:"x",processor:function(){return!0}},{tokenType:"pN",regex:"p(?:[1-9][0-9]*|0)",processor:function(r){return T(r.slice(1))}},{tokenType:"p",regex:"p",processor:function(){return!0}},{tokenType:"digit",regex:"[0-9]",processor:T},{tokenType:"digit_even",regex:"[02468]",processor:T},{tokenType:"letter",regex:"[a-zA-Z]",processor:A},{tokenType:"letter_even",regex:"[acegikmoqsuwyACEGIKMOQSUWY]",processor:A},{tokenType:"letter_capital",regex:"[A-Z]"},{tokenType:"integer",regex:"[1-9][0-9]*|[0-9]",processor:T},{tokenType:"integer_even",regex:"[1-9][0-9]*[02468]|[02468]",processor:T}],b={standard_async:function(){return g=!0,{symbol:w.trim(w.asyncSiteswap("integer",w.separator())),processor:_}},compressed_async:function(){return g=!1,{symbol:w.trim(w.asyncSiteswap({either:["digit","letter"]},null)),processor:_}},standard_sync:function(){g=!0;var r=w.separator(),n={symbols:["integer_even",{allow:"x"}],processor:function(r){var n=ir(r,2);return{value:n[0],cross:!!n[1]}}};return{symbol:w.trim(w.syncSiteswap(n,r,r)),processor:E}},compressed_sync:function(){g=!1;var r={allow:w.separator(),fixed:!0},n={symbols:[{either:["digit_even","letter_even"]},{allow:"x"}],processor:function(r){var n=ir(r,2);return{value:n[0],cross:!!n[1]}}};return{symbol:w.trim(w.syncSiteswap(n,null,r)),processor:E}},multihand:function(){g=!0;var r=w.ws(),n={symbols:["letter_capital","integer"],processor:function(r){var n=ir(r,2),t=n[0];return{value:n[1],hand:function(r){for(var n=0;"A"===r[n];)n++;if(n<r.length-1)throw new Error("Invalid input.");return n===r.length?(n-1)*i:n*i+r[n].charCodeAt(0)-a}(t)}}},t={symbols:["(",r,{allow:"-"},"integer",r,",",r,"integer",r,")"],processor:function(r){var n=ir(r,8),t=n[2],e=n[3];return{value:n[7],offset:t?-e:e}}},e=w.trim(","),o=w.trim("\n");return{symbol:w.trim({either:[w.separated(o,1,w.separated(e,1,w.release(n,e))),w.separated(o,1,w.separated(r,1,w.release(t,r)))]}),processor:F}},passing_async:function(){g=!0;w.ws();var r=w.trim(w.asyncSiteswap({symbols:["integer",{allow:"p"}],processor:function(r){var n=ir(r,2);return{value:n[0],pass:n[1]}}},w.separator())),n=w.trim(w.asyncSiteswap({symbols:["integer",{allow:"pN"}],processor:function(r){var n=ir(r,2);return{value:n[0],pass:n[1]}}},w.separator()));return{symbol:w.trim({either:[{symbols:["<",r,"|",r,">"],processor:function(r){var n=ir(r,4);return[n[1],n[3]]}},{symbols:["<",w.separated("|",2,n),">"],processor:function(r){return ir(r,2)[1]}}]}),processor:M}},passing_sync:function(){g=!0;w.ws();var r=w.separator(),n=w.separator(),t=w.separator(),e=w.separator(),o=w.trim({either:[w.syncSiteswap({symbols:["integer_even",{allow:"x"},{allow:"p"}],processor:function(r){var n=ir(r,3),t=n[0],e=n[1];return{value:t,pass:n[2],cross:e}}},r,r),w.syncSiteswap({symbols:["integer_even",{allow:"p"},{allow:"x"}],processor:function(r){var n=ir(r,3);return{value:n[0],pass:n[1],cross:n[2]}}},n,n)]}),a=w.trim({either:[w.syncSiteswap({symbols:["integer_even",{allow:"x"},{allow:"pN"}],processor:function(r){var n=ir(r,3),t=n[0],e=n[1];return{value:t,pass:n[2],cross:e}}},t,t),w.syncSiteswap({symbols:["integer_even",{allow:"pN"},{allow:"x"}],processor:function(r){var n=ir(r,3);return{value:n[0],pass:n[1],cross:n[2]}}},e,e)]});return{symbol:w.trim({either:[{symbols:["<",o,"|",o,">"],processor:function(r){var n=ir(r,4);return[n[1],n[3]]}},{symbols:["<",w.separated("|",2,a),">"],processor:function(r){return ir(r,2)[1]}}]}),processor:I}}},t=0;t<n.length;t++){var o=n[t];o.index=t,b[o.tokenType]=o}function S(r){return ir(r,2)[1]}function T(r){return Number(r)}function A(r){return r<"a"?r.charCodeAt(0)-"A".charCodeAt(0)+36:r.charCodeAt(0)-"a".charCodeAt(0)+10}function j(r,n){for(var t=Math.max(r,n),e=Math.min(r,n),o=t;o%e!=0;)o+=t;return o}function k(r){return r.concat(r.map(function(r){return r.map(function(r){return[].concat(ur(r))}).reverse()}))}function _(r){var n=!0,t=!1,e=void 0;try{for(var o,a=r[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var i=o.value,u=!0,s=!1,l=void 0;try{for(var f,c=i[Symbol.iterator]();!(u=(f=c.next()).done);u=!0)for(var h=f.value,p=0;p<h.length;p++)h[p]={value:h[p],handFrom:0,handTo:0}}catch(r){s=!0,l=r}finally{try{!u&&c.return&&c.return()}finally{if(s)throw l}}}}catch(r){t=!0,e=r}finally{try{!n&&a.return&&a.return()}finally{if(t)throw e}}return r}function E(r){var n=!0,t=!1,e=void 0;try{for(var o,a=r[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)for(var i=o.value,u=0;u<i.length;u++)for(var s=i[u],l=0;l<s.length;l++){var f=s[l],c=f.value,h=f.cross;s[l]={value:c/2,handFrom:u,handTo:h?1-u:u}}}catch(r){t=!0,e=r}finally{try{!n&&a.return&&a.return()}finally{if(t)throw e}}return r}function F(t){for(var r=t.map(function(r){return r.length}).reduce(j),e=[],n=function(n){var r=t.map(function(r){return r[n%r.length]}).map(function(r,o){return r.map(function(r){var n=r.value,t=r.hand,e=r.offset;return{value:n,handFrom:o,handTo:void 0!==e?o+e:t}})});e.push(r)},o=0;o<r;o++)n(o);return e}function M(t){for(var r=t.map(function(r){return r.length}).reduce(j),e=[],n=function(n){var r=t.map(function(r){return r[n%r.length][0]}).map(function(r,e){return r.map(function(r){var n=r.value,t=r.pass;return!0===t&&(t=2-e),{value:n,handFrom:e,handTo:null===t?e:t-1}})});e.push(r)},o=0;o<r;o++)n(o);return e}function I(e){for(var r=e.map(function(r){return r.length}).reduce(j),o=[],n=function(n){var r,t=(r=Array.prototype).concat.apply(r,ur(e.map(function(r){return r[n%r.length]}))).map(function(r,o){return r.map(function(r){var n=r.value,t=r.pass,e=r.cross;return!0===t&&(t=2-Math.floor(o/2)),{value:n/2,handFrom:o,handTo:(null===t?o:2*(t-1)+o%2)+(e?o%2?-1:1:0)}})});o.push(t)},t=0;t<r;t++)n(t);return o}var C={ERROR:!0},N=void 0,O=0;function R(r,n){if(!r||!b[r])throw new Error("Unknown notation.");"function"==typeof b[r]&&(b[r]=function n(r){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null===t){var e={immutables:[]};return e.terminals=new Set,(r=n(r,e)).immutables=e.immutables,r.terminals=[].concat(ur(e.terminals)),r}if(null===r)return r;if("string"==typeof r){if(!b[r])throw new Error("Impossible.");return n(b[r],t)}if(Array.isArray(r))return{symbols:r.map(function(r){return n(r,t)})};if(r.fixed&&t.immutables.push(r),r.tokenType)return t.terminals.add(r),r;if("object"!==(void 0===r?"undefined":x(r)))throw new Error("Impossible.");if(r.symbol)r.symbol=n(r.symbol,t);else if(r.symbols)r.symbols=r.symbols.map(function(r){return n(r,t)});else if(r.repeat)r.repeat=r.repeat.map(function(r){return n(r,t)});else if(r.either)r.either=r.either.map(function(r){return n(r,t)});else{if(!r.allow)throw new Error("Impossible.");r.either=[n(r.allow,t),null],delete r.allow}return r}(b[r]()));var t=b[r],e=!0,o=!1,a=void 0;try{for(var i,u=t.immutables[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){delete i.value.value}}catch(r){o=!0,a=r}finally{try{!e&&u.return&&u.return()}finally{if(o)throw a}}if(O=0,!(N=function(r,n){for(var t=new RegExp(r.sort(function(r,n){return r.index-n.index}).map(function(r){return"("+r.regex+")"}).join("|"),"y"),e=[];t.lastIndex<n.length;){var o=t.exec(n);if(null===o)throw new Error("nece ici care");var a=o.findIndex(function(r,n){return n&&r});e.push({type:r[a-1].tokenType,value:o[a]})}return e}(t.terminals,n)).length)return null;var s=function r(n){var t=void 0;if(null===n)return null;if(n.tokenType){var e=N[O];if(!e||e.type!==n.tokenType)return C;if(n.fixed)if(n.value){if(e.value!==n.value)return C}else n.value=e.value;t=e.value,O++}else if(n.symbol){if((t=r(n.symbol))===C)return C}else if(n.symbols){var o=!0,a=!(t=[]),i=void 0;try{for(var u,s=n.symbols[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=r(u.value);if(l===C)return C;t.push(l)}}catch(r){a=!0,i=r}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}}else if(n.repeat){for(t=[];t.length<n.max;){var f=O,c=r({symbols:n.repeat});if(c===C){O=f;break}t.push(c)}if(t.length<n.min||t.length>n.max)return C}else if(n.either){var h=!0,p=!1,v=void 0;try{for(var y,m=n.either[Symbol.iterator]();!(h=(y=m.next()).done);h=!0){var d=y.value,g=O,w=r(d);if(w!==C){var b=n.processor;if(n.fixed)if(void 0===n.value)n.value=d;else if(d!==n.value)return C;return b?b(w):w}O=g}}catch(r){p=!0,v=r}finally{try{!h&&m.return&&m.return()}finally{if(p)throw v}}return C}return n.processor?n.processor(t):t}(t);return s===C||O!==N.length?null:s}function V(r){return 2*r.value+(r.handFrom!==r.handTo?"x":"")}function U(r){return 2*r.value+(r.handFrom!==r.handTo?"x":"")}function q(r){var n=r.map(function(r){var n=r.value,t=r.handFrom,e=r.handTo;return 2*n+(t%2!=e%2?"x":"")+(e===t||e===t+(t%2?-1:1)?"":"p"+(Math.floor(e/2)+1))}).join(",");return 1===r.length?n:"["+n+"]"}var lr={"standard:async":{limits:{degree:{min:1,max:1}},hands:function(){return["Hand"]},parse:function(r){return R("standard_async",r)},unparse:function(r){return r.map(function(r){var n=ir(r,1)[0];return 1===n.length?n[0].value:"["+n.map(function(r){return r.value}).join(",")+"]"}).join(",")}},"standard:sync":{limits:{degree:{min:2,max:2}},hands:function(){return["Left","Right"]},parse:function(r){return R("standard_sync",r)},unparse:function(r){return r.map(function(r){return"("+r.map(function(r){return 1===r.length?V(r[0]):"["+r.map(V).join(",")+"]"})+")"}).join("")}},standard:["standard:async","standard:sync"],"compressed:async":{limits:{degree:{min:1,max:1},greatestValue:{max:61}},hands:function(){return["Hand"]},parse:function(r){return R("compressed_async",r)},unparse:function(r){return r.map(function(r){var n=ir(r,1)[0];return 1===n.length?n[0].value:"["+n.map(function(r){return r.value}).join("")+"]"}).join("")}},"compressed:sync":{limits:{degree:{min:2,max:2},greatestValue:{max:61}},hands:function(){return["Left","Right"]},parse:function(r){return R("compressed_sync",r)},unparse:function(r){return r.map(function(r){return"("+r.map(function(r){return 1===r.length?U(r[0]):"["+r.map(U).join("")+"]"})+")"}).join("")}},compressed:["compressed:async","compressed:sync"],"passing:async":{limits:{degree:{min:2}},hands:function(r){return Array(r).fill().map(function(r,n){return"juggler "+(n+1)})},parse:function(r){return R("passing_async",r)},unparse:function(r){for(var n=r[0].length,t=[],e=function(e){t.push(r.map(function(r){return n=r[e],t=n.map(function(r){var n=r.value,t=r.handFrom,e=r.handTo;return n+(t!==e?"p"+(e+1):"")}).join(","),1===n.length?t:"["+t+"]";var n,t}).join(","))},o=0;o<n;o++)e(o);return"<"+t.join("|")+">"}},"passing:sync":{limits:{degree:{min:4,step:2}},hands:function(r){return Array(r).fill().map(function(r,n){return"juggler "+(Math.floor(n/2)+1)+", hand "+(n%2+1)})},parse:function(r){return R("passing_sync",r)},unparse:function(r){for(var n=r[0].length,t=[],e=function(n){t.push(r.map(function(r){return"("+q(r[n])+","+q(r[n+1])+")"}).join(""))},o=0;o<n;o+=2)e(o);return"<"+t.join("|")+">"}},passing:["passing:async","passing:sync"],multihand:{hands:function(r){return Array(r).fill().map(function(r,n){return sr(n)})},parse:function(r){return R("multihand",r)},unparse:function(n){for(var r=n[0].length,t=[],e=function(e){var r=n.map(function(r){return n=r[e],t=n.map(function(r){var n=r.value,t=r.handTo;return""+sr(t)+n}).join(","),1===n.length?t:"["+t+"]";var n,t}).join(",");t.push(r)},o=0;o<r;o++)e(o);return t.join("\n")}}};function P(r){return r.every(function(r){return r.every(function(r,n,t){var e=t.length;return 1===r||0===r&&n===e-1})})}function Z(r,n,t){for(var e=0;e<r.length;e++){var o=(e+t)%r.length;if(r[o].length!==n[e].length)return!1;for(var a=0;a<r[o].length;a++){if(r[o][a].length!==n[e][a].length)return!1;for(var i=0;i<r[o][a].length;i++){var u=r[o][a][i],s=n[e][a][i];if(u.value!==s.value||u.handFrom!==s.handFrom||u.handTo!==s.handTo)return!1}}}return!0}function fr(r,n){return"string"!=typeof r&&(r=r.toString()),n++,r.length>=n?r:""+Array(n-r.length).join(" ")+r}var Siteswap=function Siteswap(r){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"compressed";u(this,Siteswap);try{var t=function(r,n){if(n=n.reduce(function(r,n){return r.concat(Array.isArray(lr[n])?lr[n]:n)},[]),"object"===(void 0===r?"undefined":x(r))){var t=n[0];if(("string"!=typeof t||!lr[t])&&null!==t)throw new Error("Unsupported notation.");return{notation:t,throws:r}}if(n.some(function(r){return"string"!=typeof r||!lr[r]}))throw new Error("Unsupported notation.");var e=!0,o=!1,a=void 0;try{for(var i,u=n[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var s=i.value,l=lr[s].parse(r);if(l)return{notation:s,throws:l}}}catch(r){o=!0,a=r}finally{try{!e&&u.return&&u.return()}finally{if(o)throw a}}throw new Error("Invalid syntax.")}(r,[].concat(n)),e=t.throws,o=t.notation;s(e),this.valid=!0,this.notation=o,this.throws=function(r){for(var n=1,t=Math.floor(r.length/2);n<=t;n++)if(r.length%n==0)for(var e=r.slice(0,n),o=n;o<r.length&&l(e,r.slice(o,o+n));o+=n)if(n+o===r.length)return r.length=n,r;return r}(e)}catch(r){return this.valid=!1,this.notation=n,this.error=r.message,this}var a=this.throws,i=a.reduce(function(r,n){return r.concat.apply(r,ur(n.map(function(r){return r.map(function(r){return r.value})})))},[]);this.degree=a[0].length,this.props=i.reduce(function(r,n){return r+n})/a.length,this.multiplex=a.reduce(function(r,n){return Math.max.apply(Math,[r].concat(ur(n.map(function(r){return r.length}))))},0),this.greatestValue=Math.max.apply(Math,ur(i)),this.states=f(this),this.strictStates=c(this),this.orbits=y(this),this.composition=m(this),this.period=this.states.length,this.fullPeriod=this.strictStates.length,this.prime=1===this.composition.length,this.groundState=this.states.some(P)};Siteswap.prototype.equals=function(r){if(!this.valid)throw new Error("Invalid siteswap.");if(!(r instanceof Siteswap&&r.valid))return!1;var n=this.throws,t=r.throws;if(n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(Z(n,t,e))return!0;return!1},Siteswap.prototype.rotate=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=this.throws;return t<0&&(t=e.length+t%e.length),new Siteswap([].concat(ur(e.map(function(r,n){return e[(n+t)%e.length]}))),this.notation)},Siteswap.prototype.toString=function(){var n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.notation;if(!this.valid)throw new Error("Invalid siteswap.");if(null===r)return JSON.stringify(this.throws);if(!lr[r]||Array.isArray(lr[r]))throw new Error("Unsupported notation.");if(this.notation!==r){var t=lr[this.notation].limits||{},e=lr[r].limits||{},o=Object.keys(e);if(o.some(function(r){return void 0!==e[r]&&void 0!==t[r]&&void 0!==e[r].min&&void 0!==t[r].max&&e[r].min>t[r].max||void 0!==e[r].max&&void 0!==t[r].min&&e[r].max<t[r].min}))throw new Error("Incompatible notations.");if(o.some(function(r){return e[r].max&&n[r]>e[r].max||e[r].min&&n[r]<e[r].min||n[r]%(e[r].step||1)!=0}))throw new Error("This siteswap can't be converted to the target notation.")}return lr[r].unparse(this.throws)},Siteswap.prototype.log=function(){var f=this;if(this.valid){var c=[],e=void 0;if(c.push("siteswap\n "+this.toString().replace(/\n/g,"\n ")),c.push("notation\n "+this.notation),c.push("degree\n "+this.degree),c.push("props\n "+this.props),c.push("period\n "+this.period),c.push("full period\n "+this.fullPeriod),c.push("multiplex\n "+this.multiplex),c.push("prime\n "+this.prime),c.push("ground state\n "+this.groundState),2<this.degree){e=Array(this.degree).fill().map(function(r,n){return sr(n)}),c.push("hand labels");var r=lr[this.notation].hands(this.degree),n=[];n.push(this.degree.toString().length+1),n.push(Math.max.apply(Math,ur(r.map(function(r){return r.length})))),n.push(Math.max.apply(Math,ur(e.map(function(r){return r.length}))));for(var t=0;t<this.degree;t++){var o=fr(t+1,n[0]),a=fr(e[t],n[2]),i=fr(r[t],n[1]);c.push(o+"| "+a+("multihand"!==this.notation?" ("+i+")":""))}}c.push("throw sequence");var u=[],s=!0,l=!1,h=void 0;try{for(var p,v=this.throws.entries()[Symbol.iterator]();!(s=(p=v.next()).done);s=!0){var y=p.value,m=ir(y,2),d=m[0],g=m[1].map(function(r){var n=void 0;return n=f.degree<=2?r.map(function(r){return r.value+(r.handFrom!==r.handTo?"x":"")}).join(","):r.map(function(r){var n=r.value,t=(r.handFrom,r.handTo);return""+n+e[t]}).join(","),1===r.length?n:"["+n+"]"});u.push([d+1+"|"].concat(ur(g)))}}catch(r){l=!0,h=r}finally{try{!s&&v.return&&v.return()}finally{if(l)throw h}}for(var w=[],b=function(n){w.push(Math.max.apply(Math,ur(u.map(function(r){return r[n].length+1}))))},x=0;x<u[0].length;x++)b(x);c.push.apply(c,ur(u.map(function(r){return r.map(function(r,n){return fr(r,w[n])}).join("")}))),c.push("states");var S=this.period.toString().length+1,T=!0,A=!1,j=void 0;try{for(var k,_=this.states.entries()[Symbol.iterator]();!(T=(k=_.next()).done);T=!0){var E=k.value,F=ir(E,2),M=F[0],I=F[1],C=!0,N=!1,O=void 0;try{for(var R,V=I.entries()[Symbol.iterator]();!(C=(R=V.next()).done);C=!0){var U=R.value,q=ir(U,2),P=q[0],Z=q[1];c.push(fr(P?" ":M+1,S)+"| ["+Z.join(",")+"]")}}catch(r){N=!0,O=r}finally{try{!C&&V.return&&V.return()}finally{if(N)throw O}}}}catch(r){A=!0,j=r}finally{try{!T&&_.return&&_.return()}finally{if(A)throw j}}c.push("strict states");var H=this.fullPeriod.toString().length+1,L=!0,z=!1,G=void 0;try{for(var J,K=this.strictStates.entries()[Symbol.iterator]();!(L=(J=K.next()).done);L=!0){var Q=J.value,W=ir(Q,2),Y=W[0],B=W[1],D=!0,X=!1,$=void 0;try{for(var rr,nr=B.entries()[Symbol.iterator]();!(D=(rr=nr.next()).done);D=!0){var tr=rr.value,er=ir(tr,2),or=er[0],ar=er[1];c.push(fr(or?"":Y+1,H)+"| ["+ar.map(function(r){return"["+(r.length?r.join(","):"-")+"]"}).join(",")+"]")}}catch(r){X=!0,$=r}finally{try{!D&&nr.return&&nr.return()}finally{if(X)throw $}}}}catch(r){z=!0,G=r}finally{try{!L&&K.return&&K.return()}finally{if(z)throw G}}c.push("orbits"),function(){var e=f.orbits.length.toString().length+1,r=function(r,t){c.push.apply(c,ur(r.toString().split("\n").map(function(r,n){return fr(n?"":t+1,e)+"| "+r})))},n=!0,t=!1,o=void 0;try{for(var a,i=f.orbits.entries()[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var u=a.value,s=ir(u,2),l=s[0];r(s[1],l)}}catch(r){t=!0,o=r}finally{try{!n&&i.return&&i.return()}finally{if(t)throw o}}}(),c.push("composition"),function(){var e=f.composition.length.toString().length+1,r=function(r,t){c.push.apply(c,ur(r.toString().split("\n").map(function(r,n){return fr(n?"":t+1,e)+"| "+r})))},n=!0,t=!1,o=void 0;try{for(var a,i=f.composition.entries()[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var u=a.value,s=ir(u,2),l=s[0];r(s[1],l)}}catch(r){t=!0,o=r}finally{try{!n&&i.return&&i.return()}finally{if(t)throw o}}}(),c.push(" "),console.log(c.join("\n"))}else console.log("Invalid siteswap.")},module.exports=Siteswap;
return module.exports;});
