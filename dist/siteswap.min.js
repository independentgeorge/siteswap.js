(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Siteswap = f()}})(function(){var define,module,exports;module={exports:(exports={})};
"use strict";function r(r){if(Array.isArray(r)){for(var n=0,t=Array(r.length);n<r.length;n++)t[n]=r[n];return t}return Array.from(r)}function n(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function t(r){if(!function(r){if(!Array.isArray(r)||!r.length)return!1;var n=function(n){return Array.isArray(n)&&n.length===r[0].length?n.some(function(r){return!Array.isArray(r)||!r.every(function(r){var t=r.value,e=r.handFrom,o=r.handTo;return void 0!==t&&void 0!==e&&void 0!==o&&e<n.length&&o<n.length})})?{v:!1}:void 0:{v:!1}},t=!0,e=!1,o=void 0;try{for(var a,i=r[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var u=a.value,s=n(u);if("object"===(void 0===s?"undefined":N(s)))return s.v}}catch(r){e=!0,o=r}finally{try{!t&&i.return&&i.return()}finally{if(e)throw o}}return!0}(r))throw new Error("Invalid input.");for(var n=r.map(function(r){return r.map(function(r){return 0})}),t=0;t<r.length;t++){var e=r[t],o=!0,a=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value,f=!0,c=!1,h=void 0;try{for(var p,v=l[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var y=p.value;n[t][y.handFrom]++,n[(t+y.value)%r.length][y.handTo]--}}catch(r){c=!0,h=r}finally{try{!f&&v.return&&v.return()}finally{if(c)throw h}}}}catch(r){a=!0,i=r}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}}if(n.some(function(r){return r.some(function(r){return 0!==r})}))throw new Error("Invalid siteswap.")}function e(r,n){if(r.length!==n.length)return!1;for(var t=0;t<r.length;t++){var e=r[t],o=n[t];if(e.length!==o.length)return!1;for(var a=0;a<e.length;a++){var i=e[a],u=o[a];if(i.length!==u.length)return!1;for(var s=0;s<i.length;s++){var l=i[s],f=u[s];if(l.value!==f.value||l.handFrom!==f.handFrom||l.handTo!==f.handTo)return!1}}}return!0}function o(r){var n=[],t=function(r){for(var n=[],t=0;t<r.degree;t++)n.push(Array(r.greatestValue).fill(0));if(0===r.greatestValue)return new State(n);for(var e=r.throws,o=0,a=-1;!0;a--){var i=e[(a%e.length+e.length)%e.length],u=!0,s=!1,l=void 0;try{for(var f,c=i[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){var h=f.value,p=!0,v=!1,y=void 0;try{for(var m,d=h[Symbol.iterator]();!(p=(m=d.next()).done);p=!0){var g=m.value,w=a+g.value;if(!(w<0)&&(n[g.handTo][w]++,++o===r.props)){var b=function(){for(var t=r.greatestValue;n.every(function(r){return 0===r[t-1]});)t--;for(var e=0;e<r.degree;e++)n[e].length=t;return{v:new State(n)}}();if("object"===(void 0===b?"undefined":N(b)))return b.v}}}catch(r){v=!0,y=r}finally{try{!p&&d.return&&d.return()}finally{if(v)throw y}}}}catch(r){s=!0,l=r}finally{try{!u&&c.return&&c.return()}finally{if(s)throw l}}}}(r),e=t;do{var o=!0,a=!1,i=void 0;try{for(var u,s=r.throws[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value;n.push(e.schedule),e=e.advance(l)}}catch(r){a=!0,i=r}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}}while(t!==e);return n}function a(n){var t=[],e=function(r){var n=0;return r.map(function(r){return r.map(function(r){return Array(r).fill().map(function(){return++n})})})}(n.states[0]),o=e;do{var a=!0,i=!1,u=void 0;try{for(var s,l=n.throws[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var f=s.value;t.push(o),o=function(n,t){for(var e=n.map(function(n){return n.slice(1).map(function(n){return[].concat(r(n))})}),o=function(r){var o=t[r];if(!o.length&&o.every(function(n){var t=n.value,e=n.handTo,o=n.handFrom;return 0===t&&e===r&&o===r}))return"continue";for(var a=0;a<o.length;a++){var i=o[a];if(!(i.value<=0)){for(var u=n[i.handFrom][0][a],s=0;s<e.length;s++)for(var l=n[0].length-1;l<i.value;l++)e[s][l]||(e[s][l]=[]);e[i.handTo][i.value-1].push(u)}}},a=0;a<t.length;a++){o(a)}return e}(o,f)}}catch(r){i=!0,u=r}finally{try{!a&&l.return&&l.return()}finally{if(i)throw u}}}while(!function(r,n){if(r.length!==n.length)return!1;for(var t=0;t<r.length;t++){var e=r[t],o=n[t];if(e.length!==o.length)return!1;for(var a=0;a<e.length;a++){var i=e[a],u=o[a];if(i.length!==u.length)return!1;for(var s=0;s<i.length;s++)if(i[s]!==u[s])return!1}}return!0}(e,o));return t}function i(r,n,t,e,o){var a=t[e][o],u=!0,s=!1,l=void 0;try{for(var f,c=a[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){var h=f.value;if(0!==h.value){var p=(e+h.value)%t.length;n[p][h.handTo]!==r&&(n[p][h.handTo]=r,i(r,n,t,p,h.handTo))}}}catch(r){s=!0,l=r}finally{try{!u&&c.return&&c.return()}finally{if(s)throw l}}}function u(r){for(var n=r.throws,t=r.notation,e=[],o=n.map(function(r){return r.map(function(r){return null})}),a=0;a<n.length;a++)for(var u=n[a],s=0;s<u.length;s++){var l=u[s];if(null===o[a][s]&&(1!==l.length||0!==l[0].value)){var f=[];i(f,o,n,a,s),e.push(f)}}if(1===e.length)return[r];for(var c=function(r){var t=n[r],a=function(n){n.push(t.map(function(t,e){return o[r][e]===n?t:[{value:0,handFrom:e,handTo:e}]}))},i=!0,u=!1,s=void 0;try{for(var l,f=e[Symbol.iterator]();!(i=(l=f.next()).done);i=!0){a(l.value)}}catch(r){u=!0,s=r}finally{try{!i&&f.return&&f.return()}finally{if(u)throw s}}},h=0;h<n.length;h++)c(h);return e.map(function(r){return new Siteswap(r,t)})}function s(n){for(var t=[],e=[].concat(r(n.throws)),o=[].concat(r(n.states)),a=n.notation,i=0,u=1;u<=o.length;u++)for(var s=u-1;s>=i;s--)if(o[u%o.length]===o[s]){if(0===s&&u===o.length)return t.length?(l(t,new Siteswap(e.slice(s,u),a)),t):[n];i===s?(l(t,new Siteswap(e.slice(s,u),a)),i=u):(l(t,new Siteswap(e.splice(s,u-s),a)),o.splice(s,u-s),u=i);break}return t}function l(r,n){r.every(function(r){return!r.equals(n)})&&r.push(n)}function f(r){return"A".repeat(Math.floor(r/V))+String.fromCharCode(R+r%V)}function c(r){return I(r,2)[1]}function h(r){return Number(r)}function p(r){return r<"a"?r.charCodeAt(0)-"A".charCodeAt(0)+36:r.charCodeAt(0)-"a".charCodeAt(0)+10}function v(r,n){for(var t=Math.max(r,n),e=Math.min(r,n),o=t;o%e!=0;)o+=t;return o}function y(n){return n.concat(n.map(function(n){return n.map(function(n){return[].concat(r(n))}).reverse()}))}function m(r){var n=!0,t=!1,e=void 0;try{for(var o,a=r[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var i=o.value,u=!0,s=!1,l=void 0;try{for(var f,c=i[Symbol.iterator]();!(u=(f=c.next()).done);u=!0)for(var h=f.value,p=0;p<h.length;p++)h[p]={value:h[p],handFrom:0,handTo:0}}catch(r){s=!0,l=r}finally{try{!u&&c.return&&c.return()}finally{if(s)throw l}}}}catch(r){t=!0,e=r}finally{try{!n&&a.return&&a.return()}finally{if(t)throw e}}return r}function d(r){var n=!0,t=!1,e=void 0;try{for(var o,a=r[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)for(var i=o.value,u=0;u<i.length;u++)for(var s=i[u],l=0;l<s.length;l++){var f=s[l],c=f.value,h=f.cross;s[l]={value:c/2,handFrom:u,handTo:h?1-u:u}}}catch(r){t=!0,e=r}finally{try{!n&&a.return&&a.return()}finally{if(t)throw e}}return r}function g(r){for(var n=r.map(function(r){return r.length}).reduce(v),t=[],e=function(n){var e=r.map(function(r){return r[n%r.length]}).map(function(r,n){return r.map(function(r){var t=r.value,e=r.hand,o=r.offset;return{value:t,handFrom:n,handTo:void 0!==o?n+o:e}})});t.push(e)},o=0;o<n;o++)e(o);return t}function w(r){for(var n=r.map(function(r){return r.length}).reduce(v),t=[],e=function(n){var e=r.map(function(r){return r[n%r.length][0]}).map(function(r,n){return r.map(function(r){var t=r.value,e=r.pass;!0===e&&(e=2-n);return{value:t,handFrom:n,handTo:null===e?n:e-1}})});t.push(e)},o=0;o<n;o++)e(o);return t}function b(n){for(var t=n.map(function(r){return r.length}).reduce(v),e=[],o=function(t){var o,a=(o=Array.prototype).concat.apply(o,r(n.map(function(r){return r[t%r.length]}))).map(function(r,n){return r.map(function(r){var t=r.value,e=r.pass,o=r.cross;!0===e&&(e=2-Math.floor(n/2));return{value:t/2,handFrom:n,handTo:(null===e?n:2*(e-1)+n%2)+(o?n%2?-1:1:0)}})});e.push(a)},a=0;a<t;a++)o(a);return e}function x(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===t){var e={};return e.immutables=[],e.terminals=new Set,n=x(n,e),n.immutables=e.immutables,n.terminals=[].concat(r(e.terminals)),n}if(null===n)return n;if("string"==typeof n){if(!Z[n])throw new Error("Impossible.");return x(Z[n],t)}if(Array.isArray(n))return{symbols:n.map(function(r){return x(r,t)})};if(n.fixed&&t.immutables.push(n),n.tokenType)return t.terminals.add(n),n;if("object"!==(void 0===n?"undefined":N(n)))throw new Error("Impossible.");if(n.symbol)n.symbol=x(n.symbol,t);else if(n.symbols)n.symbols=n.symbols.map(function(r){return x(r,t)});else if(n.repeat)n.repeat=n.repeat.map(function(r){return x(r,t)});else if(n.either)n.either=n.either.map(function(r){return x(r,t)});else{if(!n.allow)throw new Error("Impossible.");n.either=[x(n.allow,t),null],delete n.allow}return n}function S(r){var n=void 0;if(null===r)return null;if(r.tokenType){var t=G[J];if(!t||t.type!==r.tokenType)return z;if(r.fixed)if(r.value){if(t.value!==r.value)return z}else r.value=t.value;n=t.value,J++}else if(r.symbol){if((n=S(r.symbol))===z)return z}else if(r.symbols){n=[];var e=!0,o=!1,a=void 0;try{for(var i,u=r.symbols[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var s=S(i.value);if(s===z)return z;n.push(s)}}catch(r){o=!0,a=r}finally{try{!e&&u.return&&u.return()}finally{if(o)throw a}}}else if(r.repeat){for(n=[];n.length<r.max;){var l=J,f=S({symbols:r.repeat});if(f===z){J=l;break}n.push(f)}if(n.length<r.min||n.length>r.max)return z}else if(r.either){var c=!0,h=!1,p=void 0;try{for(var v,y=r.either[Symbol.iterator]();!(c=(v=y.next()).done);c=!0){var m=v.value,d=J,g=S(m);if(g!==z){var w=r.processor;if(r.fixed)if(void 0===r.value)r.value=m;else if(m!==r.value)return z;return w?w(g):g}J=d}}catch(r){h=!0,p=r}finally{try{!c&&y.return&&y.return()}finally{if(h)throw p}}return z}return r.processor?r.processor(n):n}function T(r,n){if(!r||!Z[r])throw new Error("Unknown notation.");"function"==typeof Z[r]&&(Z[r]=x(Z[r]()));var t=Z[r],e=!0,o=!1,a=void 0;try{for(var i,u=t.immutables[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){delete i.value.value}}catch(r){o=!0,a=r}finally{try{!e&&u.return&&u.return()}finally{if(o)throw a}}if(J=0,!(G=function(r,n){for(var t=new RegExp(r.sort(function(r,n){return r.index-n.index}).map(function(r){return"("+r.regex+")"}).join("|"),"y"),e=[];t.lastIndex<n.length;){var o=t.exec(n);if(null===o)throw new Error("nece ici care");var a=o.findIndex(function(r,n){return n&&r});e.push({type:r[a-1].tokenType,value:o[a]})}return e}(t.terminals,n)).length)return null;var s=S(t);return s===z||J!==G.length?null:s}function A(r){return 2*r.value+(r.handFrom!==r.handTo?"x":"")}function j(r){return 2*r.value+(r.handFrom!==r.handTo?"x":"")}function k(r){var n=r.map(function(r){var n=r.value,t=r.handFrom,e=r.handTo;return 2*n+(t%2!=e%2?"x":"")+(e===t||e===t+(t%2?-1:1)?"":"p"+(Math.floor(e/2)+1))}).join(",");return 1===r.length?n:"["+n+"]"}function _(r){for(var n=r[0].length,t=[],e=function(n){var e=r.map(function(r){return function(r){var n=r.map(function(r){var n=r.value;return""+f(r.handTo)+n}).join(",");return 1===r.length?n:"["+n+"]"}(r[n])}).join(",");t.push(e)},o=0;o<n;o++)e(o);return t.join("\n")}function E(r,n){if(n=n.reduce(function(r,n){return r.concat(Array.isArray(K[n])?K[n]:n)},[]),"object"===(void 0===r?"undefined":N(r))){var t=n[0];if(("string"!=typeof t||!K[t])&&null!==t)throw new Error("Unsupported notation.");return{notation:t,throws:r}}if(n.some(function(r){return"string"!=typeof r||!K[r]}))throw new Error("Unsupported notation.");var e=!0,o=!1,a=void 0;try{for(var i,u=n[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var s=i.value,l=K[s].parse(r);if(l)return{notation:s,throws:l}}}catch(r){o=!0,a=r}finally{try{!e&&u.return&&u.return()}finally{if(o)throw a}}throw new Error("Invalid syntax.")}function F(r){return r.every(function(r){return r.every(function(r,n,t){var e=t.length;return 1===r||0===r&&n===e-1})})}function M(r,n){return"string"!=typeof r&&(r=r.toString()),n++,r.length>=n?r:""+Array(n-r.length).join(" ")+r}for(var I=function(){return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,n){var t=[],e=!0,o=!1,a=void 0;try{for(var i,u=r[Symbol.iterator]();!(e=(i=u.next()).done)&&(t.push(i.value),!n||t.length!==n);e=!0);}catch(r){o=!0,a=r}finally{try{!e&&u.return&&u.return()}finally{if(o)throw a}}return t}(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),C=function(){function r(r,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}return function(n,t,e){return t&&r(n.prototype,t),e&&r(n,e),n}}(),N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},O={schedules:new Map,strings:new Map},State=function(){function State(r){if(n(this,State),!Array.isArray(r)||!r.every(Array.isArray))throw new Error("Invalid input.");var t=O.schedules.get(r);if(t)return t;var e=r.map(function(r){return r.join(",")}).join("-");if(t=O.strings.get(e))return t;O.schedules.set(r,this),O.strings.set(e,this),this.schedule=r}return C(State,[{key:"advance",value:function(r){for(var n=this.schedule.map(function(r){return r.slice(1)}),t=0;t<r.length;t++){var e=r[t];if(e.filter(function(r){return r.value}).length!==(this.schedule[t][0]||0))throw new Error("dead");if(e.length){var o=!0,a=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value,f=l.value,c=l.handTo;l.handFrom;if(!(f<=0)){n[c][f-1]=(n[c][f-1]||0)+1;for(var h=0;h<n.length;h++)for(var p=this.schedule[0].length-1;p<f;p++)n[h][p]||(n[h][p]=0)}}}catch(r){a=!0,i=r}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}}}return new State(n)}}]),State}(),R="A".charCodeAt(0),V="Z".charCodeAt(0)-R+1,U=!0,q={ws:function(){return{allow:" "}},trim:function(r){var n=q.ws();return{symbols:[n,r,n],processor:function(r){return I(r,2)[1]}}},separator:function(){if(U){var r=q.ws();return{either:[{symbols:[r,",",r]}," "],fixed:!0}}return{either:[","," "],fixed:!0}},separated:function(n,t,e){return{symbols:[e,{repeat:[n,e],min:t-1,max:1/0}],processor:function(n){var t=I(n,2),e=t[0],o=function(r){return Array.isArray(r)?r:Array.from(r)}(t[1]).slice(0);return[e].concat(r(o.map(c)))}}},release:function(r,n){var t=q.separated(n,2,r);return{either:[{symbols:[r]},{symbols:["[",U?q.trim(t):t,"]"],processor:function(r){return I(r,2)[1]}}]}},asyncSiteswap:function(r,n){q.ws();return{symbol:q.separated(n,1,q.release(r,n)),processor:function(r){return r.map(function(r){return[r]})}}},syncSiteswap:function(r,n,t){var e=q.ws(),o=q.release(r,n);if(U){var a={symbols:["(",e,o,t,o,e,")"],processor:function(r){var n=I(r,5);return[n[2],n[4]]}};return{symbols:[q.separated(e,1,a),e,{allow:"*"}],processor:function(r){var n=I(r,3),t=n[0];return n[2]?y(t):t}}}var i={symbols:["(",o,t,o,")"],processor:function(r){var n=I(r,4);return[n[1],n[3]]}};return{symbols:[q.separated(null,1,i),{allow:"*"}],processor:function(r){var n=I(r,2),t=n[0];return n[1]?y(t):t}}}},P=[{tokenType:"[",regex:"\\["},{tokenType:"]",regex:"\\]"},{tokenType:"(",regex:"\\("},{tokenType:")",regex:"\\)"},{tokenType:"<",regex:"<"},{tokenType:">",regex:">"},{tokenType:"\n",regex:"\n"},{tokenType:"|",regex:"\\|"},{tokenType:"-",regex:"-"},{tokenType:",",regex:","},{tokenType:" ",regex:" +"},{tokenType:"*",regex:"\\*"},{tokenType:"x",regex:"x",processor:function(){return!0}},{tokenType:"pN",regex:"p(?:[1-9][0-9]*|0)",processor:function(r){return h(r.slice(1))}},{tokenType:"p",regex:"p",processor:function(){return!0}},{tokenType:"digit",regex:"[0-9]",processor:h},{tokenType:"digit_even",regex:"[02468]",processor:h},{tokenType:"letter",regex:"[a-zA-Z]",processor:p},{tokenType:"letter_even",regex:"[acegikmoqsuwyACEGIKMOQSUWY]",processor:p},{tokenType:"letter_capital",regex:"[A-Z]"},{tokenType:"integer",regex:"[1-9][0-9]*|[0-9]",processor:h},{tokenType:"integer_even",regex:"[1-9][0-9]*[02468]|[02468]",processor:h}],Z={standard_async:function(){return U=!0,{symbol:q.trim(q.asyncSiteswap("integer",q.separator())),processor:m}},compressed_async:function(){return U=!1,{symbol:q.trim(q.asyncSiteswap({either:["digit","letter"]},null)),processor:m}},standard_sync:function(){U=!0;var r=q.separator(),n={symbols:["integer_even",{allow:"x"}],processor:function(r){var n=I(r,2);return{value:n[0],cross:!!n[1]}}};return{symbol:q.trim(q.syncSiteswap(n,r,r)),processor:d}},compressed_sync:function(){U=!1;var r={allow:q.separator(),fixed:!0},n={symbols:[{either:["digit_even","letter_even"]},{allow:"x"}],processor:function(r){var n=I(r,2);return{value:n[0],cross:!!n[1]}}};return{symbol:q.trim(q.syncSiteswap(n,null,r)),processor:d}},multihand:function(){U=!0;var r=q.ws(),n={symbols:["letter_capital","integer"],processor:function(r){var n=I(r,2),t=n[0];return{value:n[1],hand:function(r){for(var n=0;"A"===r[n];)n++;if(n<r.length-1)throw new Error("Invalid input.");return n===r.length?(n-1)*V:n*V+r[n].charCodeAt(0)-R}(t)}}},t={symbols:["(",r,{allow:"-"},"integer",r,",",r,"integer",r,")"],processor:function(r){var n=I(r,8),t=n[2],e=n[3];return{value:n[7],offset:t?-e:e}}},e=q.trim(","),o=q.trim("\n");return{symbol:q.trim({either:[q.separated(o,1,q.separated(e,1,q.release(n,e))),q.separated(o,1,q.separated(r,1,q.release(t,r)))]}),processor:g}},passing_async:function(){U=!0;q.ws();var r=q.trim(q.asyncSiteswap({symbols:["integer",{allow:"p"}],processor:function(r){var n=I(r,2);return{value:n[0],pass:n[1]}}},q.separator())),n=q.trim(q.asyncSiteswap({symbols:["integer",{allow:"pN"}],processor:function(r){var n=I(r,2);return{value:n[0],pass:n[1]}}},q.separator()));return{symbol:q.trim({either:[{symbols:["<",r,"|",r,">"],processor:function(r){var n=I(r,4);return[n[1],n[3]]}},{symbols:["<",q.separated("|",2,n),">"],processor:function(r){return I(r,2)[1]}}]}),processor:w}},passing_sync:function(){U=!0;q.ws();var r=q.separator(),n=q.separator(),t=q.separator(),e=q.separator(),o=q.trim({either:[q.syncSiteswap({symbols:["integer_even",{allow:"x"},{allow:"p"}],processor:function(r){var n=I(r,3),t=n[0],e=n[1];return{value:t,pass:n[2],cross:e}}},r,r),q.syncSiteswap({symbols:["integer_even",{allow:"p"},{allow:"x"}],processor:function(r){var n=I(r,3);return{value:n[0],pass:n[1],cross:n[2]}}},n,n)]}),a=q.trim({either:[q.syncSiteswap({symbols:["integer_even",{allow:"x"},{allow:"pN"}],processor:function(r){var n=I(r,3),t=n[0],e=n[1];return{value:t,pass:n[2],cross:e}}},t,t),q.syncSiteswap({symbols:["integer_even",{allow:"pN"},{allow:"x"}],processor:function(r){var n=I(r,3);return{value:n[0],pass:n[1],cross:n[2]}}},e,e)]});return{symbol:q.trim({either:[{symbols:["<",o,"|",o,">"],processor:function(r){var n=I(r,4);return[n[1],n[3]]}},{symbols:["<",q.separated("|",2,a),">"],processor:function(r){return I(r,2)[1]}}]}),processor:b}}},H=0;H<P.length;H++){var L=P[H];L.index=H,Z[L.tokenType]=L}var z={ERROR:!0},G=void 0,J=0,K={"standard:async":{limits:{degree:{min:1,max:1}},hands:function(){return["Hand"]},parse:function(r){return T("standard_async",r)},unparse:function(r){return r.map(function(r){var n=I(r,1)[0];return 1===n.length?n[0].value:"["+n.map(function(r){return r.value}).join(",")+"]"}).join(",")}},"standard:sync":{limits:{degree:{min:2,max:2}},hands:function(){return["Left","Right"]},parse:function(r){return T("standard_sync",r)},unparse:function(r){return r.map(function(r){return"("+r.map(function(r){return 1===r.length?A(r[0]):"["+r.map(A).join(",")+"]"})+")"}).join("")}},standard:["standard:async","standard:sync"],"compressed:async":{limits:{degree:{min:1,max:1},greatestValue:{max:61}},hands:function(){return["Hand"]},parse:function(r){return T("compressed_async",r)},unparse:function(r){return r.map(function(r){var n=I(r,1)[0];return 1===n.length?n[0].value:"["+n.map(function(r){return r.value}).join("")+"]"}).join("")}},"compressed:sync":{limits:{degree:{min:2,max:2},greatestValue:{max:61}},hands:function(){return["Left","Right"]},parse:function(r){return T("compressed_sync",r)},unparse:function(r){return r.map(function(r){return"("+r.map(function(r){return 1===r.length?j(r[0]):"["+r.map(j).join("")+"]"})+")"}).join("")}},compressed:["compressed:async","compressed:sync"],"passing:async":{limits:{degree:{min:2}},hands:function(r){return Array(r).fill().map(function(r,n){return"juggler "+(n+1)})},parse:function(r){return T("passing_async",r)},unparse:function(r){for(var n=r[0].length,t=[],e=function(n){t.push(r.map(function(r){return function(r){var n=r.map(function(r){var n=r.value,t=r.handFrom,e=r.handTo;return n+(t!==e?"p"+(e+1):"")}).join(",");return 1===r.length?n:"["+n+"]"}(r[n])}).join(","))},o=0;o<n;o++)e(o);return"<"+t.join("|")+">"}},"passing:sync":{limits:{degree:{min:4,step:2}},hands:function(r){return Array(r).fill().map(function(r,n){return"juggler "+(Math.floor(n/2)+1)+", hand "+(n%2+1)})},parse:function(r){return T("passing_sync",r)},unparse:function(r){for(var n=r[0].length,t=[],e=function(n){t.push(r.map(function(r){return"("+k(r[n])+","+k(r[n+1])+")"}).join(""))},o=0;o<n;o+=2)e(o);return"<"+t.join("|")+">"}},passing:["passing:async","passing:sync"],multihand:{hands:function(r){return Array(r).fill().map(function(r,n){return f(n)})},parse:function(r){return T("multihand",r)},unparse:_}},Siteswap=function Siteswap(i){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"compressed";n(this,Siteswap);try{var f=E(i,[].concat(l)),c=f.throws,h=f.notation;t(c),this.valid=!0,this.notation=h,this.throws=function(r){for(var n=1,t=Math.floor(r.length/2);n<=t;n++)if(r.length%n==0)for(var o=r.slice(0,n),a=n;a<r.length&&e(o,r.slice(a,a+n));a+=n)if(n+a===r.length)return r.length=n,r;return r}(c)}catch(r){return this.valid=!1,this.notation=l,this.error=r.message,this}var p=this.throws,v=p.reduce(function(n,t){return n.concat.apply(n,r(t.map(function(r){return r.map(function(r){return r.value})})))},[]);this.degree=p[0].length,this.props=v.reduce(function(r,n){return r+n})/p.length,this.multiplex=p.reduce(function(n,t){return Math.max.apply(Math,[n].concat(r(t.map(function(r){return r.length}))))},0),this.greatestValue=Math.max.apply(Math,r(v)),this.states=o(this),this.strictStates=a(this),this.orbits=u(this),this.composition=s(this),this.period=this.states.length,this.fullPeriod=this.strictStates.length,this.prime=1===this.composition.length,this.groundState=this.states.some(F)};Siteswap.prototype.equals=function(r){if(!this.valid)throw new Error("Invalid siteswap.");if(!(r instanceof Siteswap&&r.valid))return!1;var n=this.throws,t=r.throws;if(n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(function(r,n,t){for(var e=0;e<r.length;e++){var o=(e+t)%r.length;if(r[o].length!==n[e].length)return!1;for(var a=0;a<r[o].length;a++){if(r[o][a].length!==n[e][a].length)return!1;for(var i=0;i<r[o][a].length;i++){var u=r[o][a][i],s=n[e][a][i];if(u.value!==s.value||u.handFrom!==s.handFrom||u.handTo!==s.handTo)return!1}}}return!0}(n,t,e))return!0;return!1},Siteswap.prototype.rotate=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.throws;return n<0&&(n=t.length+n%t.length),new Siteswap([].concat(r(t.map(function(r,e){return t[(e+n)%t.length]}))),this.notation)},Siteswap.prototype.toString=function(){var r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.notation;if(!this.valid)throw new Error("Invalid siteswap.");if(null===n)return JSON.stringify(this.throws);if(!K[n]||Array.isArray(K[n]))throw new Error("Unsupported notation.");if(this.notation!==n){var t=K[this.notation].limits||{},e=K[n].limits||{},o=Object.keys(e);if(o.some(function(r){return void 0!==e[r]&&void 0!==t[r]&&void 0!==e[r].min&&void 0!==t[r].max&&e[r].min>t[r].max||void 0!==e[r].max&&void 0!==t[r].min&&e[r].max<t[r].min}))throw new Error("Incompatible notations.");if(o.some(function(n){return e[n].max&&r[n]>e[n].max||e[n].min&&r[n]<e[n].min||r[n]%(e[n].step||1)!=0}))throw new Error("This siteswap can't be converted to the target notation.")}return K[n].unparse(this.throws)},Siteswap.prototype.log=function(){var n=this;if(this.valid){var t=[],e=void 0;if(t.push("siteswap\n "+this.toString().replace(/\n/g,"\n ")),t.push("notation\n "+this.notation),t.push("degree\n "+this.degree),t.push("props\n "+this.props),t.push("period\n "+this.period),t.push("full period\n "+this.fullPeriod),t.push("multiplex\n "+this.multiplex),t.push("prime\n "+this.prime),t.push("ground state\n "+this.groundState),this.degree>2){e=Array(this.degree).fill().map(function(r,n){return f(n)}),t.push("hand labels");var o=K[this.notation].hands(this.degree),a=[];a.push(this.degree.toString().length+1),a.push(Math.max.apply(Math,r(o.map(function(r){return r.length})))),a.push(Math.max.apply(Math,r(e.map(function(r){return r.length}))));for(var i=0;i<this.degree;i++){var u=M(i+1,a[0]),s=M(e[i],a[2]),l=M(o[i],a[1]);t.push(u+"| "+s+("multihand"!==this.notation?" ("+l+")":""))}}t.push("throw sequence");var c=[],h=!0,p=!1,v=void 0;try{for(var y,m=this.throws.entries()[Symbol.iterator]();!(h=(y=m.next()).done);h=!0){var d=y.value,g=I(d,2),w=g[0],b=g[1].map(function(r){var t=void 0;return t=n.degree<=2?r.map(function(r){return r.value+(r.handFrom!==r.handTo?"x":"")}).join(","):r.map(function(r){var n=r.value,t=(r.handFrom,r.handTo);return""+n+e[t]}).join(","),1===r.length?t:"["+t+"]"});c.push([w+1+"|"].concat(r(b)))}}catch(r){p=!0,v=r}finally{try{!h&&m.return&&m.return()}finally{if(p)throw v}}for(var x=[],S=function(n){x.push(Math.max.apply(Math,r(c.map(function(r){return r[n].length+1}))))},T=0;T<c[0].length;T++)S(T);t.push.apply(t,r(c.map(function(r){return r.map(function(r,n){return M(r,x[n])}).join("")}))),t.push("states");var A=this.period.toString().length+1,j=!0,k=!1,_=void 0;try{for(var E,F=this.states.entries()[Symbol.iterator]();!(j=(E=F.next()).done);j=!0){var C=E.value,N=I(C,2),O=N[0],R=N[1],V=!0,U=!1,q=void 0;try{for(var P,Z=R.entries()[Symbol.iterator]();!(V=(P=Z.next()).done);V=!0){var H=P.value,L=I(H,2),z=L[0],G=L[1];t.push(M(z?" ":O+1,A)+"| ["+G.join(",")+"]")}}catch(r){U=!0,q=r}finally{try{!V&&Z.return&&Z.return()}finally{if(U)throw q}}}}catch(r){k=!0,_=r}finally{try{!j&&F.return&&F.return()}finally{if(k)throw _}}t.push("strict states");var J=this.fullPeriod.toString().length+1,Q=!0,W=!1,Y=void 0;try{for(var B,D=this.strictStates.entries()[Symbol.iterator]();!(Q=(B=D.next()).done);Q=!0){var X=B.value,$=I(X,2),rr=$[0],nr=$[1],tr=!0,er=!1,or=void 0;try{for(var ar,ir=nr.entries()[Symbol.iterator]();!(tr=(ar=ir.next()).done);tr=!0){var ur=ar.value,sr=I(ur,2),lr=sr[0],fr=sr[1];t.push(M(lr?"":rr+1,J)+"| ["+fr.map(function(r){return"["+(r.length?r.join(","):"-")+"]"}).join(",")+"]")}}catch(r){er=!0,or=r}finally{try{!tr&&ir.return&&ir.return()}finally{if(er)throw or}}}}catch(r){W=!0,Y=r}finally{try{!Q&&D.return&&D.return()}finally{if(W)throw Y}}t.push("orbits"),function(){var e=n.orbits.length.toString().length+1,o=function(n,o){t.push.apply(t,r(n.toString().split("\n").map(function(r,n){return M(n?"":o+1,e)+"| "+r})))},a=!0,i=!1,u=void 0;try{for(var s,l=n.orbits.entries()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var f=s.value,c=I(f,2),h=c[0];o(c[1],h)}}catch(r){i=!0,u=r}finally{try{!a&&l.return&&l.return()}finally{if(i)throw u}}}(),t.push("composition"),function(){var e=n.composition.length.toString().length+1,o=function(n,o){t.push.apply(t,r(n.toString().split("\n").map(function(r,n){return M(n?"":o+1,e)+"| "+r})))},a=!0,i=!1,u=void 0;try{for(var s,l=n.composition.entries()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var f=s.value,c=I(f,2),h=c[0];o(c[1],h)}}catch(r){i=!0,u=r}finally{try{!a&&l.return&&l.return()}finally{if(i)throw u}}}(),t.push(" "),console.log(t.join("\n"))}else console.log("Invalid siteswap.")},module.exports=Siteswap;
return module.exports;});